<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Exec.Command" /><meta property="og:locale" content="en" /><meta name="description" content="Going a step further from executing system commands through Go." /><meta property="og:description" content="Going a step further from executing system commands through Go." /><link rel="canonical" href="https://mzampetakis.com/posts/Exec-Command/" /><meta property="og:url" content="https://mzampetakis.com/posts/Exec-Command/" /><meta property="og:site_name" content="Michalis Zampetakis" /><meta property="og:image" content="https://mzampetakis.com/assets/posts/Exec-Command/cmd.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-05-07T00:40:00+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://mzampetakis.com/assets/posts/Exec-Command/cmd.jpg" /><meta property="twitter:title" content="Exec.Command" /><meta name="twitter:site" content="@mzampetakis" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-03-20T02:50:32+08:00","datePublished":"2021-05-07T00:40:00+08:00","description":"Going a step further from executing system commands through Go.","headline":"Exec.Command","image":{"show_in_post":false,"url":"https://mzampetakis.com/assets/posts/Exec-Command/cmd.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://mzampetakis.com/posts/Exec-Command/"},"url":"https://mzampetakis.com/posts/Exec-Command/"}</script><title>Exec.Command | Michalis Zampetakis</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Michalis Zampetakis"><meta name="application-name" content="Michalis Zampetakis"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/sample/me.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Michalis Zampetakis</a></div><div class="site-subtitle font-italic">Curiosity Driven</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/now/" class="nav-link"> <i class="fa-fw fas fa-clock ml-xl-3 mr-xl-3 unloaded"></i> <span>NOW</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/mzampetakis" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/mzampetakis" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mzampetakis','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="" aria-label="linkedin" > <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Exec.Command</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Exec.Command</h1><div class="post-meta text-muted"><div></div><div class="d-flex"><div> <span> Posted <em class="timeago" inalid-data-ts="1620319200" > May 7, 2021 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1387 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><p>One of the key features of Go is the considerably rich standard library. <a href="https://golang.org/pkg/os/">Go’s os package</a> offers a wide range of methods and functions to allow programmers to exploit the host’s OS capabilities. Using it leaves us with almost no need to invoke system commands. However, we need sometimes to execute a custom bash script or a system command not supported by some library or just invoke a 3rd party’s executable file!</p><p>Go provides a pretty handy mechanism to manage - not just execute - system commands. The <a href="https://golang.org/pkg/os/exec/">os/exec package</a> is the mechanism that Go provides to run external commands and we are going to examine it here!</p><blockquote><p>Unlike the “system” library call from C and other languages, the os/exec package intentionally does not invoke the system shell and does not expand any glob patterns or handle other expansions, pipelines, or redirections typically done by shells.</p></blockquote><h2 id="executing-a-command-in-go"><span class="mr-2">Executing a command in Go</span><a href="#executing-a-command-in-go" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Executing a system command In Go can be initialized by invoking the os/exec’s command <code class="language-plaintext highlighter-rouge">Command()</code>. The most common way to execute the command is to use the <code class="language-plaintext highlighter-rouge">Run()</code> method:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"log"</span>
	<span class="s">"os/exec"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">cmd</span> <span class="o">:=</span> <span class="n">exec</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span><span class="s">"date"</span><span class="p">)</span>
	<span class="n">err</span> <span class="o">:=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"cmd.Run() failed with %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>In this example we are running the <code class="language-plaintext highlighter-rouge">date</code> command. The command is initialized through the <code class="language-plaintext highlighter-rouge">cmd := exec.Command("date")</code> command which returns an <code class="language-plaintext highlighter-rouge">exec.Cmd</code> struct to execute the named program with the given arguments. <code class="language-plaintext highlighter-rouge">cmd.Run()</code> executes the given command and the returned error is nil if the command runs, has no problems copying stdin, stdout, and stderr, and exits with a zero exit status.</p><h2 id="the-cmd-struct"><span class="mr-2">The cmd struct</span><a href="#the-cmd-struct" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The <code class="language-plaintext highlighter-rouge">exec.Cmd</code> struct is the return value of an <code class="language-plaintext highlighter-rouge">exec.Command()</code> function. Cmd represents an external command being prepared or run. A Cmd cannot be reused after calling its Run, Output, or CombinedOutput methods which are presented at the following chapters. This struct contains all the information required for a command to be described before execution and its public fields are more or less self explanatory:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">type</span> <span class="n">Cmd</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">Path</span> <span class="kt">string</span>
	<span class="n">Args</span> <span class="p">[]</span><span class="kt">string</span>
	<span class="n">Env</span> <span class="p">[]</span><span class="kt">string</span>
	<span class="n">Dir</span> <span class="kt">string</span>
	<span class="n">Stdin</span> <span class="n">io</span><span class="o">.</span><span class="n">Reader</span>
	<span class="n">Stdout</span> <span class="n">io</span><span class="o">.</span><span class="n">Writer</span>
	<span class="n">Stderr</span> <span class="n">io</span><span class="o">.</span><span class="n">Writer</span>
	<span class="n">ExtraFiles</span> <span class="p">[]</span><span class="o">*</span><span class="n">os</span><span class="o">.</span><span class="n">File</span>
	<span class="n">SysProcAttr</span> <span class="o">*</span><span class="n">syscall</span><span class="o">.</span><span class="n">SysProcAttr</span>
	<span class="n">Process</span> <span class="o">*</span><span class="n">os</span><span class="o">.</span><span class="n">Process</span>
	<span class="n">ProcessState</span> <span class="o">*</span><span class="n">os</span><span class="o">.</span><span class="n">ProcessState</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In our previous example, using the <code class="language-plaintext highlighter-rouge">cmd := exec.Command("date")</code> we just initialized the Cmd struct with the <code class="language-plaintext highlighter-rouge">Path</code> of the date command and no data provided for the <code class="language-plaintext highlighter-rouge">Args</code>.</p><p>More details about the Cmd struct can be found <a href="https://golang.org/pkg/os/exec/#Cmd">at the golang.org</a>.</p><blockquote><p>Note - I’m writing this post on a MacOS using commands that may not work on other OS such as Linux or Windows.</p></blockquote><h2 id="capturing-the-commands-output"><span class="mr-2">Capturing the command’s output</span><a href="#capturing-the-commands-output" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>In our example, after executing the <code class="language-plaintext highlighter-rouge">date</code> command we do not retrieve the returned data. It is really common task to retrieve the returned data after executing a command in order to process them appropriately.</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"log"</span>
	<span class="s">"os/exec"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">cmd</span> <span class="o">:=</span> <span class="n">exec</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span><span class="s">"date"</span><span class="p">)</span>
	<span class="n">dt</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"cmd.Run() failed with %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The example above will print the current system’s date upon running:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Mon  4 May 2021 22:46:33 EEST
</pre></table></code></div></div><p>The output returned by a <code class="language-plaintext highlighter-rouge">cmd.Output()</code> execution is a byte array that can the managed as a string for further processing.</p><h2 id="providing-arguments-to-the-command"><span class="mr-2">Providing arguments to the command</span><a href="#providing-arguments-to-the-command" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>There are cases where we have to provide extra arguments to our command for execution. This is feasible using the same <code class="language-plaintext highlighter-rouge">exec.Command()</code> function where arguments can be provided after the command’s name: <code class="language-plaintext highlighter-rouge">func Command(name string, arg ...string) *Cmd</code>. Each argument should be supplied as a different <code class="language-plaintext highlighter-rouge">arg</code>. For instance if we have to set up a command for the <code class="language-plaintext highlighter-rouge">ls -al /tmp/</code> command we have to invoke <code class="language-plaintext highlighter-rouge">exec.Command("ls", "-al", "/tmp/")</code>.</p><blockquote><p>exec.Command() is an example of a Variadic Function. Variadic Functions can be called with any number of trailing arguments, therefore, we can pass in as many arguments to our initial command as we desire.</p></blockquote><h3 id="splitting-commands-args"><span class="mr-2">Splitting command’s args</span><a href="#splitting-commands-args" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Preparing to execute a command using Go’s <code class="language-plaintext highlighter-rouge">exec.Command()</code> function can sometimes be painful - especially when we have to provide lots of arguments to our command. Thankfully we can prepare our command as one string and then use the <code class="language-plaintext highlighter-rouge">strings.fields()</code> function to split it to separate arguments.</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"log"</span>
	<span class="s">"os/exec"</span>
	<span class="s">"strings"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">cmdStr</span> <span class="o">:=</span> <span class="s">"ls -al /tmp/"</span>
	<span class="n">cmdArgs</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Fields</span><span class="p">(</span><span class="n">cmdStr</span><span class="p">)</span>
	<span class="n">cmd</span> <span class="o">:=</span> <span class="n">exec</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span><span class="n">cmdArgs</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">cmdArgs</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">]</span><span class="o">...</span><span class="p">)</span>
	<span class="n">dt</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"cmd.Run() failed with %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In the example above we prepared our command <code class="language-plaintext highlighter-rouge">ls -al /tmp/</code> as a string, then split its fields, and used the first element as the command to execute while the rest of the fields used as arguments.</p><blockquote><p>As Fields splits the string around each instance of one or more consecutive white space characters, we have to take extra care when using it - especially when we have space characters within a single arguments.</p></blockquote><h2 id="other-ways-of-executing-a-command"><span class="mr-2">Other ways of executing a command</span><a href="#other-ways-of-executing-a-command" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>There are cases where we want to initiate a command’s execution without having to wait until its completion. Especially when we have to execute long-running shell scripts where we don’t expect some output we can initiate a command using the <code class="language-plaintext highlighter-rouge">Start()</code> method.</p><p>In some cases we just have to wait or completion of a command we can use the <code class="language-plaintext highlighter-rouge">Wait()</code> method. In addition to the <code class="language-plaintext highlighter-rouge">Run()</code> method, <code class="language-plaintext highlighter-rouge">Wait()</code> waits for the command to exit and waits for any copying to stdin or copying from stdout or stderr to complete.</p><p>We saw previously how we can capture a command’s output using the <code class="language-plaintext highlighter-rouge">Output()</code> method. In cases we want to capture the standard error as well, then we can use the <code class="language-plaintext highlighter-rouge">CombinedOutput()</code> method. This method behaves exactly like the Output method and has the same signature.</p><h2 id="using-commands-pipes"><span class="mr-2">Using commands’ pipes</span><a href="#using-commands-pipes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>In an <code class="language-plaintext highlighter-rouge">exec.Command()</code> we can provide the Stdin which specifies the process’s standard input. The StdinPipe returns a pipe that will be connected to the command’s standard input when the command starts. In the example below we can see how can we exploit this provided <code class="language-plaintext highlighter-rouge">Cmd.StdinPipe</code> in order to feed our <code class="language-plaintext highlighter-rouge">cat</code> command with some text upon startup:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"io"</span>
    <span class="s">"log"</span>
    <span class="s">"os/exec"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">cmd</span> <span class="o">:=</span> <span class="n">exec</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span><span class="s">"cat"</span><span class="p">)</span>
    <span class="n">stdin</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">StdinPipe</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">defer</span> <span class="n">stdin</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="n">io</span><span class="o">.</span><span class="n">WriteString</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="s">"some random text"</span><span class="p">)</span>
    <span class="p">}()</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">CombinedOutput</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In this example we expect the output to be: <code class="language-plaintext highlighter-rouge">some random text</code>.<br /> Accordingly, we can exploit a command’s <code class="language-plaintext highlighter-rouge">Cmd.StdoutPipe</code> in order to grab the output of the executed command as a stream.</p><h2 id="a-hint-"><span class="mr-2">A hint 😉</span><a href="#a-hint-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>As we saw there are various ways we are able to prepare a command for execution using Go’s <code class="language-plaintext highlighter-rouge">exec.Command</code>. Most of the times we are adding parameters and conditional arguments while “preparing” a command for execution. Most of the times we have to log a command before execution. <code class="language-plaintext highlighter-rouge">exec.Command()</code> provides the <code class="language-plaintext highlighter-rouge">String()</code> method which allows us to print the final form of the command for execution.</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"os/exec"</span>
	<span class="s">"strings"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">command</span> <span class="o">:=</span> <span class="s">"ls"</span>
	<span class="n">path</span> <span class="o">:=</span> <span class="s">"/tmp/"</span>
	<span class="n">cmdStr</span> <span class="o">:=</span> <span class="n">command</span> <span class="o">+</span> <span class="s">" -al "</span> <span class="o">+</span> <span class="n">path</span>
	<span class="n">cmdArgs</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Fields</span><span class="p">(</span><span class="n">cmdStr</span><span class="p">)</span>
	<span class="n">cmd</span> <span class="o">:=</span> <span class="n">exec</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span><span class="n">cmdArgs</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">cmdArgs</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">]</span><span class="o">...</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The result of the program above should be: <code class="language-plaintext highlighter-rouge">ls -al /tmp/</code>. So, using the <code class="language-plaintext highlighter-rouge">String()</code> method of a command we can easily retrieve the command we are going to execute!</p><h2 id="sum-up"><span class="mr-2">Sum Up</span><a href="#sum-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Using Go to manage and execute commands within our apps is a common use case. Go provides, through the exec package, a variety of functions and methods to support such tasks. By exploiting the Command struct we have a pretty powerful way to manage and execute commands according to our needs.</p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/golang/" class="post-tag no-text-decoration" >golang</a> <a href="/tags/coding/" class="post-tag no-text-decoration" >coding</a> <a href="/tags/shell/" class="post-tag no-text-decoration" >shell</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Exec.Command+-+Michalis+Zampetakis&url=https%3A%2F%2Fmzampetakis.com%2Fposts%2FExec-Command%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Exec.Command+-+Michalis+Zampetakis&u=https%3A%2F%2Fmzampetakis.com%2Fposts%2FExec-Command%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmzampetakis.com%2Fposts%2FExec-Command%2F&text=Exec.Command+-+Michalis+Zampetakis" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/testing/">testing</a> <a class="post-tag" href="/tags/blogging/">blogging</a> <a class="post-tag" href="/tags/image-processing/">image-processing</a> <a class="post-tag" href="/tags/lego/">LEGO</a> <a class="post-tag" href="/tags/oauth/">oAuth</a> <a class="post-tag" href="/tags/shell/">shell</a> <a class="post-tag" href="/tags/time/">time</a> <a class="post-tag" href="/tags/toy-project/">toy-project</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Log-Requests-in-Go/"><div class="card-body"> <em class="timeago small" inalid-data-ts="1597696800" > Aug 18, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Log Requests in Go</h3><div class="text-muted small"><p> It’s a common sense that logging your HTTP request in your application is essential. The reasons for doing so are numerous. Error reporting, tracing, monitoring, performance tuning and so on. One ...</p></div></div></a></div><div class="card"> <a href="/posts/AquaGo-A-Toy-Project/"><div class="card-body"> <em class="timeago small" inalid-data-ts="1598902800" > Sep 1, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AquaGo - A Toy Project</h3><div class="text-muted small"><p> Just imagine if you could have on your living’s room TV an aquarium! Wouldn’t that be nice, especially during the hot period of summertime? What about if you could add digital fishes and decorative...</p></div></div></a></div><div class="card"> <a href="/posts/Deep-Dive-in-Go-Channels/"><div class="card-body"> <em class="timeago small" inalid-data-ts="1604123700" > Oct 31, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Deep Dive in Go Channels</h3><div class="text-muted small"><p> One of the biggest advantages of Go is undoubtedly it’s concurrency management. Goroutines are the main feature that Go uses to achieve this. Goroutines wouldn’t be so easy if there wasn’t for chan...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Deep-Dive-in-Go-Channels/" class="btn btn-outline-primary" prompt="Older"><p>Deep Dive in Go Channels</p></a> <a href="/posts/Testing-the-Tests/" class="btn btn-outline-primary" prompt="Newer"><p>Testing the Tests</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://mzampetakis.com">Michalis Zampetakis</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme. Images from <a href="https://unsplash.com/" target="_blank" rel="noopener">Unsplash</a></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/testing/">testing</a> <a class="post-tag" href="/tags/blogging/">blogging</a> <a class="post-tag" href="/tags/image-processing/">image-processing</a> <a class="post-tag" href="/tags/lego/">LEGO</a> <a class="post-tag" href="/tags/oauth/">oAuth</a> <a class="post-tag" href="/tags/shell/">shell</a> <a class="post-tag" href="/tags/time/">time</a> <a class="post-tag" href="/tags/toy-project/">toy-project</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-172730569-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-172730569-1'); }); </script>
